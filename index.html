<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Weather App</title>
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <div class="jumbotron bg-dark text-white py-2" id="jumbo">
        <h1 class="text-center">Weather Dashboard</h1>
    </div>

    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="bg-light border-right" id="sidebar-wrapper">
            <div class="sidebar-heading">
                Search for a City:
            </div>

            <div class="form-inline">
                <form class="example mb-2">
                    <input type="text" class="form-control" id="city-search"></textarea>
                    <button type="submit" id="find-city" class="btn btn-primary py-2"><i
                            class="fa fa-search"></i></button>
                </form>
            </div>
            <div class="list-group list-group-flush" id="city-name">
            </div>
        </div>

        <div id="page-content-wrapper">
            <div class="container-fluid m-4 p-2 border">
                <h2 class="mt-4" id="city-info"></h2>
                <p id="weatherInfo"></p>
            </div>

            <div class="container-fluid m-4" id="forecast"></div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                console.log("loaded");
            });

            var searched = {};
            var createButton = $("<div>");
            var uv;
            var now = moment().format('l');
            console.log(now);

            $("#find-city").on("click", function (event) {
                event.preventDefault();

                var city = $("#city-search").val();
                var queryURL = "http://api.openweathermap.org/data/2.5/weather?q=" + city + "&APPID=35bb60361aad6d32da6fd285f2854917";

                $.ajax({
                    url: queryURL,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);
                    var cityName = response.name;
                    var cityTemp = response.main.temp;
                    var cityHumid = response.main.humidity;
                    var citySpeed = response.wind.speed;
                    var cityLat = response.coord.lat;
                    var cityLon = response.coord.lon;
                    var cityIcon = response.weather[0].icon;
                    var iconUrl = "http://openweathermap.org/img/w/" + cityIcon + ".png";
                    console.log(iconUrl);

                    function uvIndex() {
                        var uvUrl = "http://api.openweathermap.org/data/2.5/uvi?lat=" + cityLat + "&lon=" + cityLon + "&APPID=35bb60361aad6d32da6fd285f2854917";
                        $.ajax({
                            url: uvUrl,
                            method: "GET"
                        }).then(function (res) {
                            console.log(res);
                            var uv = res.value;
                            var uvButton = $("<button type='button'>");

                            uvButton.addClass("btn btn-success");
                            uvButton.html(uv);
                            console.log(uvButton);
                            $("#weatherInfo").append("UV Index: " + uvButton + "<br>");
                        });
                    };

                    // Side bar cities
                    var listGroup = $("<a href='#''>");
                    listGroup.addClass("list-group-item list-group-item-action bg-light");
                    listGroup.text(cityName);
                    $("#city-name").append(listGroup);

                    // Main Section
                    var iconPic = $("<img id='icon'>");
                    iconPic.attr("src", iconUrl);
                    console.log(iconPic);

                    $("#city-info").text(cityName + " (" + now + ") " + iconPic);
                    $("#weatherInfo").append("Temperature: " + cityTemp + "<br>");
                    $("#weatherInfo").append("Humidity: " + cityHumid + "%" + "<br>");
                    $("#weatherInfo").append("Wind Speed: " + citySpeed + " MPH" + "<br>");
                    uvIndex();


                });
            });
        </script>
</body>

</html>